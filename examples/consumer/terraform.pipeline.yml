# Example Terraform pipeline using unified actionGroups + actions

parameters:
  - name: enableProduction
    type: boolean
    default: false
  - name: runReviewStage
    type: boolean
    default: true
  - name: drInvocation
    type: boolean
    default: false
  - name: skip_dev
    type: boolean
    default: false
  - name: skip_qa
    type: boolean
    default: false
  - name: skip_preprod
    type: boolean
    default: false
  - name: skip_prod
    type: boolean
    default: false

extends:
  template: terraform.settings.yml
  parameters:
    enableProduction: ${{ parameters.enableProduction }}
    runReviewStage: ${{ parameters.runReviewStage }}
    drInvocation: ${{ parameters.drInvocation }}
    skip_dev: ${{ parameters.skip_dev }}
    skip_qa: ${{ parameters.skip_qa }}
    skip_preprod: ${{ parameters.skip_preprod }}
    skip_prod: ${{ parameters.skip_prod }}
    actionGroups:
      - name: tf_task_1
        type: terraform
        displayName: Terraform Single
        tokenReplaceEnabled: true
        tokenTargetPatterns:
          - examples/assets/terraform/**/*.tfvars
        actions:
          - name: one
            workingDirectory: examples/assets/terraform/one
            varFilesString: examples/assets/terraform/vars.tfvars
      - name: tf_task_2
        type: terraform
        displayName: Terraform Grouped
        tokenReplaceEnabled: true
        tokenTargetPatterns:
          - examples/assets/terraform/**/*.tfvars
        actions:
          - name: two
            workingDirectory: examples/assets/terraform/two
            varFilesString: examples/assets/terraform/vars.tfvars
          - name: three
            workingDirectory: examples/assets/terraform/three
            varFilesString: examples/assets/terraform/vars.tfvars
